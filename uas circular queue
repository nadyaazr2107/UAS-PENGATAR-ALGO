 #include <iostream>
#include <string>
using namespace std;

#define MAX 10

// =======================
// Struktur Data Booking Tiket
// =======================
struct Booking {
    int customer_id;
    string movie_name;
    string show_time;
    string cinema_location;
    int ticket_price;
    int tickets_booked;
    string booking_status;
};

// Circular Queue
Booking queue[MAX];
int front = -1;
int rear = -1;

// =======================
// Cek antrean penuh
// =======================
bool isFull() {
    return (front == (rear + 1) % MAX);
}

// =======================
// Cek antrean kosong
// =======================
bool isEmpty() {
    return (front == -1);
}

// =======================
// Enqueue Booking
// =======================
void enqueueBooking(Booking dataBooking) {
    if (isFull()) {
        cout << "Antrean booking penuh!\n";
        return;
    }

    if (isEmpty()) {
        front = rear = 0;
    } else {
        rear = (rear + 1) % MAX;
    }

    queue[rear] = dataBooking;
    cout << "Booking tiket berhasil ditambahkan ke antrean.\n";
}

// =======================
// Dequeue Booking
// =======================
void dequeueBooking() {
    if (isEmpty()) {
        cout << "Antrean kosong, tidak ada booking untuk dilayani.\n";
        return;
    }

    Booking served = queue[front];
    served.booking_status = "Served";

    cout << "\nBooking Dilayani:\n";
    cout << "Customer ID     : " << served.customer_id << endl;
    cout << "Film            : " << served.movie_name << endl;
    cout << "Lokasi Bioskop  : " << served.cinema_location << endl;
    cout << "Jumlah Tiket    : " << served.tickets_booked << endl;
    cout << "Total Harga     : Rp" 
         << served.ticket_price * served.tickets_booked << endl;
    cout << "Status          : Served\n";

    if (front == rear) {
        front = rear = -1;
    } else {
        front = (front + 1) % MAX;
    }
}

// =======================
// Tampilkan Booking Premium
// =======================
void tampilkanBookingPremium() {
    if (isEmpty()) {
        cout << "Tidak ada booking dalam antrean.\n";
        return;
    }

    int batasHarga = 100000;
    int i = front;

    cout << "\nDaftar Booking Premium (> Rp100.000 per tiket):\n";
    while (true) {
        if (queue[i].ticket_price > batasHarga) {
            cout << "Customer ID : " << queue[i].customer_id
                 << " | Film : " << queue[i].movie_name
                 << " | Harga : Rp" << queue[i].ticket_price << endl;
        }

        if (i == rear) break;
        i = (i + 1) % MAX;
    }
}

// =======================
// Hitung Booking Menunggu
// =======================
int hitungBookingMenunggu() {
    if (isEmpty()) return 0;

    int count = 0;
    int i = front;

    while (true) {
        if (queue[i].booking_status == "Waiting") {
            count++;
        }

        if (i == rear) break;
        i = (i + 1) % MAX;
    }

    return count;
}

// =======================
// Ubah Status Booking
// =======================
bool ubahStatusBooking(int customer_id, string statusBaru) {
    if (isEmpty()) return false;

    int i = front;
    while (true) {
        if (queue[i].customer_id == customer_id) {
            queue[i].booking_status = statusBaru;
            return true;
        }

        if (i == rear) break;
        i = (i + 1) % MAX;
    }

    return false;
}

// =======================
// Program Utama
// =======================
int main() {
    int pilihan;

    do {
        cout << "\n=== SISTEM ANTREAN TIKET BIOSKOP ===\n";
        cout << "1. Enqueue Booking Tiket\n";
        cout << "2. Dequeue Booking\n";
        cout << "3. Tampilkan Booking Premium\n";
        cout << "4. Hitung Booking Menunggu\n";
        cout << "5. Ubah Status Booking\n";
        cout << "0. Keluar\n";
        cout << "Pilih menu: ";
        cin >> pilihan;

        if (pilihan == 1) {
            Booking b;
            cout << "Customer ID        : "; cin >> b.customer_id;
            cin.ignore();
            cout << "Nama Film          : "; getline(cin, b.movie_name);
            cout << "Jam Tayang         : "; getline(cin, b.show_time);
            cout << "Lokasi Bioskop     : "; getline(cin, b.cinema_location);
            cout << "Harga Tiket        : "; cin >> b.ticket_price;
            cout << "Jumlah Tiket       : "; cin >> b.tickets_booked;
            b.booking_status = "Waiting";

            enqueueBooking(b);
        }
        else if (pilihan == 2) {
            dequeueBooking();
        }
        else if (pilihan == 3) {
            tampilkanBookingPremium();
        }
        else if (pilihan == 4) {
            cout << "Jumlah booking menunggu: "
                 << hitungBookingMenunggu() << endl;
        }
        else if (pilihan == 5) {
            int id;
            string status;
            cout << "Masukkan Customer ID: ";
            cin >> id;
            cout << "Status Baru (Waiting/Served): ";
            cin >> status;

            if (ubahStatusBooking(id, status)) {
                cout << "Status booking berhasil diubah.\n";
            } else {
                cout << "Booking tidak ditemukan.\n";
            }
        }
        else if (pilihan != 0) {
            cout << "Pilihan tidak valid.\n";
        }

    } while (pilihan != 0);

    cout << "Program selesai.\n";
    return 0;
}
